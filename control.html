<!DOCTYPE html>
<html>
  <head>
    <title>Disco Light Control</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background-color: #121212;
        color: white;
      }
      .color-button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        color: white;
        font-weight: bold;
        cursor: pointer;
        border-radius: 5px;
      }
      #preview {
        margin-top: 20px;
        padding: 20px;
        font-size: 18px;
        border: 2px solid #333;
        border-radius: 10px;
        text-align: center;
        transition: background-color 0.4s;
      }
    </style>
  </head>
  <body>
    <h2>üéõÔ∏è Disco Light Controller</h2>

    <h3>üé® Choose a Color:</h3>
    <div>
      <button class="color-button" style="background-color: red;" onclick="setColor('#FF0000')">Red</button>
      <button class="color-button" style="background-color: green;" onclick="setColor('#00FF00')">Green</button>
      <button class="color-button" style="background-color: blue;" onclick="setColor('#0000FF')">Blue</button>
      <button class="color-button" style="background-color: yellow; color: black;" onclick="setColor('#FFFF00')">Yellow</button>
      <button class="color-button" style="background-color: cyan; color: black;" onclick="setColor('#00FFFF')">Cyan</button>
      <button class="color-button" style="background-color: magenta;" onclick="setColor('#FF00FF')">Magenta</button>
      <button class="color-button" style="background-color: white; color: black;" onclick="setColor('#FFFFFF')">White</button>
      <button class="color-button" style="background-color: black;" onclick="setColor('#000000')">Black</button>
    </div>

    <div id="preview">Current Color: <span id="colorBox">None</span></div>

    <hr>

    <h3>Add an Image to Stage:</h3>
    <input type="text" id="imageUrl" placeholder="Enter image URL" style="width: 60%; padding: 10px;">
    <button onclick="addImageUrl()">Add Image</button>

    <hr>

    <h3>üßæ Current Stage Images</h3>
    <div id="stageImagesList">Loading...</div>

    <script>
      // Replace with your Google Apps Script URL
      const apiUrl = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';

      async function setColor(color) {
        try {
          const res = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ color })
          });
          if (!res.ok) {
            console.error('Failed to set color:', res.status);
            return;
          }
          const responseData = await res.json();
          console.log(responseData); // Log the server response
          updateDisplay(color);
        } catch (error) {
          console.error('Error setting color:', error);
        }
      }

      function updateDisplay(color) {
        document.getElementById("colorBox").innerText = color;
        document.getElementById("preview").style.backgroundColor = color;
      }

      async function addImageUrl() {
        const imageUrl = document.getElementById("imageUrl").value;
        if (!imageUrl) return alert("Please enter a valid image URL.");
        try {
          const res = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ addImage: imageUrl })
          });
          if (res.ok) {
            document.getElementById("imageUrl").value = "";
            loadStageImages();
          }
        } catch (error) {
          console.error('Error adding image:', error);
        }
      }

      async function loadStageImages() {
        try {
          const res = await fetch(apiUrl);
          const data = await res.json();
          const container = document.getElementById("stageImagesList");
          container.innerHTML = "";

          (data.images || []).forEach((img, index) => {
            const div = document.createElement("div");
            div.classList.add("stage-image");

            const image = document.createElement("img");
            image.src = img.url;

            const hideBtn = document.createElement("button");
            hideBtn.textContent = img.visible ? "üëÅÔ∏è Hide" : "üëª Show";
            hideBtn.className = "hide-btn";
            hideBtn.onclick = async () => {
              await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ toggleImage: index })
              });
              loadStageImages();
            };

            const removeBtn = document.createElement("button");
            removeBtn.textContent = "‚ùå Remove";
            removeBtn.onclick = async () => {
              await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ removeImage: index })
              });
              loadStageImages();
            };

            div.appendChild(image);
            div.appendChild(hideBtn);
            div.appendChild(removeBtn);
            container.appendChild(div);
          });
        } catch (error) {
          console.error('Error loading images:', error);
        }
      }

      loadStageImages();
    </script>
  </body>
</html>
